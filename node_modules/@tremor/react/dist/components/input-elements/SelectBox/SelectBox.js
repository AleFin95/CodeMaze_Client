'use client';
import{__rest as e}from"tslib";import t,{useMemo as l,useState as o,useRef as r,useEffect as n}from"react";import{twMerge as a}from"tailwind-merge";import i from"../../../assets/ArrowDownHeadIcon.js";import s from"../../../hooks/useInternalState.js";import u from"../../../hooks/useSelectOnKeyDown.js";import"../../../contexts/BaseColorContext.js";import m from"../../../contexts/HoveredValueContext.js";import"../../../contexts/RootStylesContext.js";import c from"../../../contexts/SelectedValueContext.js";import{BaseColors as d}from"../../../lib/constants.js";import{borderRadius as p,border as g,boxShadow as f}from"../../../lib/shape.js";import{sizing as h}from"../../../lib/sizing.js";import{spacing as v}from"../../../lib/spacing.js";import{fontSize as x,fontWeight as w}from"../../../lib/font.js";import{colorPalette as b,DEFAULT_COLOR as j}from"../../../lib/theme.js";import{mergeRefs as C,getColorClassNames as S,makeClassName as E}from"../../../lib/utils.js";import{constructValueToNameMapping as y,getFilteredOptions as D,getSelectButtonColors as V,hasValue as N}from"../selectUtils.js";import R from"../../util-elements/Modal/Modal.js";const B=E("SelectBox"),M=t.forwardRef(((E,M)=>{const{defaultValue:k,value:K,onValueChange:I,placeholder:L="Select...",disabled:O=!1,icon:H,children:P,className:T,onKeyDown:z}=E,A=e(E,["defaultValue","value","onValueChange","placeholder","disabled","icon","children","className","onKeyDown"]),F=l((()=>y(P)),[P]),[U,X]=s(k,K),[Y,q]=o(F.get(U||"")||""),[G,J]=o(""),[Q,W]=o(!1),Z=r(null),$=r(null),_=H,ee=N(U);n((()=>{void 0!==U&&q(F.get(U)||"")}),[U,F]);const te=t.Children.map(P,(e=>Object.assign({},e.props))),le=D(G,te),oe=new Set(le.map((e=>{var t;return null!==(t=e.text)&&void 0!==t?t:e.value}))),re=le.map((e=>e.value)),ne=e=>{var t,l;!1===e?null===(t=$.current)||void 0===t||t.blur():(null===(l=$.current)||void 0===l||l.focus(),$.current&&($.current.selectionStart=$.current.value.length,$.current.selectionEnd=$.current.value.length)),W(e)},ae=e=>{var t;J(""),void 0!==e&&q(F.get(e)||""),ne(!1),X(e),null===(t=$.current)||void 0===t||t.blur(),null==I||I(e)},[ie,se]=u(ae,re,Q,ne,U);return t.createElement("div",Object.assign({ref:C([Z,M]),onKeyDown:e=>{se(e),null==z||z(e)},className:a("relative w-full min-w-[10rem]",T)},A),t.createElement("button",{className:a(B("root"),"flex w-full items-center overflow-hidden cursor-text focus:outline-none focus:ring-2",V(ee,O),Q&&a("ring-2",S(d.Blue,b.ring).ringColor),S(d.Blue,b.lightRing).focusRingColor,p.md.all,g.sm.all,f.sm),onClick:e=>{ne(!Q),e.preventDefault()},disabled:O},_?t.createElement(_,{className:a(B("icon"),"shrink-0 bg-inherit",h.lg.height,h.lg.width,v.xl.marginLeft,S(j,b.lightText).textColor),"aria-hidden":"true"}):null,t.createElement("input",{ref:$,type:"text",className:a(B("input"),"w-full focus:outline-none focus:ring-0 bg-inherit",_?v.lg.paddingLeft:v.twoXl.paddingLeft,v.sm.paddingY,x.sm,w.md,g.none.all,O?"placeholder:text-gray-400":"placeholder:text-gray-500"),placeholder:L,value:Y,onChange:e=>{J(e.target.value),q(e.target.value)},onFocus:()=>ne(!0),onMouseDown:e=>e.preventDefault()}),t.createElement(i,{className:a(B("arrowDownIcon"),"flex-none",h.lg.height,h.lg.width,v.lg.marginRight,S(j,b.lightText).textColor),"aria-hidden":"true"})),t.createElement(R,{showModal:0!==le.length&&Q,setShowModal:ne,parentRef:Z},t.createElement(c.Provider,{value:{selectedValue:U,handleValueChange:ae}},t.createElement(m.Provider,{value:{hoveredValue:ie}},t.Children.map(P,(e=>{var l;const o=null!==(l=e.props.text)&&void 0!==l?l:e.props.value;return oe.has(String(o))?t.cloneElement(e):null}))))))}));M.displayName="SelectBox";export{M as default};
